# Zoom 발화자 하이라이트 트래킹 연동 요구사항 문서

## 1. 목적
Zoom 회의에서 발화자가 UI상으로 하이라이트되는 시점을 외부 스크립트로 트래킹하여, 발화자별 타임스탬프 기록 결과를 Obsidian Summar 플러그인에서 자동으로 노트로 정리한다.

## 2. 시스템 구성
- **외부 스크립트**: Zoom 화면을 캡처하고, 이미지 분석을 통해 발화자 하이라이트를 감지하여 결과를 파일(JSON/CSV)로 저장
- **Obsidian Summar 플러그인**: 결과 파일을 읽어 마크다운 문서로 변환 및 노트 생성/삽입

## 3. 상세 요구사항

### A. 외부 스크립트
- **macOS 지원**: macOS에서 동작 가능해야 함
- **Zoom 회의 화면 주기적 캡처**
    - **macOS 기본 도구 우선 적용**
        - `screencapture` 커맨드: macOS 기본 스크린샷 도구 (전체/지정 영역/특정 윈도우 캡처)
            - 예시: `screencapture -l <윈도우ID> <저장경로>` (`윈도우ID`는 `lsappinfo` 등으로 획득)
            - 예시: `screencapture -R<좌표,크기> <저장경로>` (지정 영역 캡처)
            - **윈도우ID/좌표 추출**: AppleScript, Swift 등으로 Zoom 윈도우의 위치/크기, 윈도우ID를 신뢰성 있게 추출해야 하며, Zoom이 여러 창(공유화면 등)일 때의 처리 방안도 고려해야 함
        - **AppleScript**: Zoom 윈도우 위치/크기 자동화, 스크린샷 트리거 등 macOS GUI 자동화 활용
            - 예시: AppleScript로 Zoom 윈도우 위치/크기 파악 후 screencapture와 연계
        - **Swift/Automator**: macOS 네이티브 앱/스크립트로 화면 캡처 및 윈도우 제어
        - **기타**: `osascript`, `imagesnap` 등 macOS에서 기본 제공 또는 쉽게 설치 가능한 도구
    - **외부 라이브러리 사용 필요 시** (예: Python의 pyautogui, mss 등)
        - macOS 기본 도구로 Zoom 회의창만 정확히 캡처할 수 없는 경우
        - Zoom UI의 특정 영역(발화자 하이라이트 등)만을 자동으로 인식/분리해야 하는 경우
        - 고급 이미지 처리, OCR, UI 자동화 등 macOS 기본 도구로 구현이 어렵거나 불가능한 경우
- **이미지 분석(OpenCV 등)으로 발화자 하이라이트 감지**
    - **이미지 분석 단계**
        1. **캡처 이미지 전처리**
            - 해상도, 색상, 노이즈 등 분석에 적합하게 변환
            - 필요시 ROI(관심영역) 추출 (예: Zoom 참가자 영역만 자르기)
        2. **발화자 하이라이트 영역 탐지**
            - Zoom UI의 하이라이트(테두리, 밝기, 색상 등) 특징 정의
            - OpenCV 등으로 해당 특징을 가진 영역 탐색
            - **하이라이트 특징 정의**: 테두리 색상, 두께, 밝기 등 구체적 시각적 특징 예시와 Zoom 버전별 UI 차이 고려
        3. **발화자 이름 영역 추출 및 OCR**
            - 하이라이트된 영역에서 이름이 표시되는 부분만 추가로 추출
            - Tesseract 등 OCR로 이름 텍스트 인식
            - **OCR 언어/정확도**: 한글/영문 혼용 환경에서 Tesseract 언어 설정, 사전 학습 데이터 적용 등 OCR 정확도 향상 방안 명시
        4. **발화자 변경 감지 및 타임스탬프 기록**
            - 이전 프레임과 비교하여 하이라이트/이름이 바뀌면 타임스탬프 기록
            - 동일 발화자 지속 시 구간만 갱신
            - **예외 처리**: Zoom 창이 닫힘, 캡처 실패, OCR 실패 등 예외 상황에 대한 상세 로그 및 사용자 알림 방안 명시
        5. **결과 데이터 정리**
            - 발화자별 시작/종료 시각, 이름을 구조화하여 저장(JSON/CSV)
- **결과 파일 저장**
    - 분석 결과(발화자별 시작/종료 시각, 이름 등)는 반드시 사용자가 지정한 경로(예: Summar 플러그인 설정에서 지정한 폴더)로 저장해야 함
    - 파일명은 회의 일시, Zoom Meeting ID, 또는 고유 식별자가 포함되어야 하며, 중복/덮어쓰기를 방지해야 함
        - 예시: `zoom_speaker_log_20250605T100000_ID123456.json` (일시와 ID 포함)
    - 파일 포맷은 JSON(권장) 또는 CSV로 저장하며, 구조는 플러그인에서 쉽게 파싱할 수 있도록 명확하게 정의
    - 타임스탬프 포맷: ISO8601(예: 2025-06-05T10:00:00+09:00), 초 단위까지 기록, 타임존 포함
    - 저장 경로에 파일이 정상적으로 생성/갱신되었는지 예외 처리 및 로그 기록
    - 저장 경로가 존재하지 않을 경우 자동 생성 또는 사용자에게 안내(권장)
    - 동시 파일 생성/갱신 충돌 방지: 여러 인스턴스가 동시에 파일을 쓸 때 임시파일 사용, 파일 락 등 충돌 방지 방안 명시
- **CPU 점유율 최소화 방안**
    - 캡처 주기를 1~2초(실시간성이 크게 필요 없다면 2~3초)로 설정
    - 전체 화면이 아닌 Zoom 참가자/발화자 영역(ROI)만 잘라서 분석
    - OCR/이미지 분석에 필요한 최소 해상도로 이미지를 리사이즈하여 처리
    - 이전 프레임과 비교하여 하이라이트/이름이 바뀌지 않으면 OCR/분석을 건너뜀(프레임간 변화 감지)
    - 필요시 멀티프로세싱/스레딩 등으로 분석을 분리하여 메인 프로세스 부하 최소화
- **Summar Plugin과의 연동**
    - Summar Plugin의 "Zoom 미팅 시작 시 자동 녹음" 옵션과 연동하여 Zoom 미팅이 시작될 때 외부 스크립트(발화자 트래킹)도 자동으로 시작될 수 있어야 함
    - 플러그인에서 외부 스크립트 실행/종료를 트리거할 수 있는 명령 또는 API 제공(권장)
    - 외부 스크립트가 정상적으로 실행/종료되었는지 플러그인에서 상태를 확인할 수 있어야 함(권장)
    - 동기화/IPC: Summar Plugin과 외부 스크립트 간 동기화(프로세스 통신, 상태 확인 등) 방식과 예시 명시
- **보안/권한**
    - macOS에서 스크린샷, OCR 등 기능을 위해 접근성 권한, 화면 기록 권한이 필요할 수 있으므로, 권한 안내 및 획득 절차 명시

### B. Obsidian Summar 플러그인 (상세 요구사항)
- **결과 파일 경로 설정**
    - 사용자가 플러그인 설정에서 외부 스크립트의 결과 파일(폴더) 경로를 직접 지정할 수 있어야 함
    - 경로 변경 시 즉시 반영 및 유효성 검사(존재하지 않을 경우 안내)
- **결과 파일 감지 및 읽기**
    - 지정 경로에 새 결과 파일이 생성/갱신되면 자동 또는 수동(명령어/버튼)로 감지
        - 자동 감지 방식: 파일시스템 이벤트(watch) 또는 주기적 폴링 방식 중 선택, 구현 방식 명시
    - 파일 포맷(JSON/CSV) 자동 감지 및 파싱, 구조가 맞지 않을 경우 오류 안내
- **마크다운 변환 및 노트 생성/삽입**
    - 결과 데이터를 표 등 마크다운 포맷으로 변환(발화자, 시작/종료 시각 등)
    - 새로운 노트로 생성하거나, 사용자가 선택한 기존 노트에 삽입 가능
    - 노트 제목/본문 포맷 커스터마이즈: 템플릿 변수(회의명, 일시 등) 사용 예시와 함께 구체적 옵션 명시
- **자동화 및 동기화**
    - 결과 파일이 변경될 때마다 노트 자동 갱신(옵션)
    - 여러 회의 결과 파일을 한 노트에 모아 관리하는 기능(옵션)
        - 다중 회의 통합 방식: 회의별 구분자, 날짜별 섹션 등 구체적 병합 방식 명시
- **에러 및 예외 처리**
    - 결과 파일이 없거나, 포맷이 잘못된 경우 사용자에게 명확한 안내 및 로그 제공
    - 파일 읽기/파싱/노트 생성 중 오류 발생 시 상세 메시지 출력
- **외부 스크립트 연동**
    - Zoom 미팅 자동 녹음 옵션이 활성화된 경우, 발화자 트래킹 스크립트도 자동 실행/종료
    - 외부 스크립트 실행/종료 명령(버튼/명령어) 제공 및 상태 표시(실행 중/정상 종료 등)
    - 외부 스크립트 실행 로그/상태를 플러그인 UI에서 확인 가능(선택)
- **사용자 경험(UX)**
    - 주요 기능(결과 파일 불러오기, 노트 생성/삽입, 외부 스크립트 실행 등)에 대해 명확한 버튼/명령어/상태 표시 제공
    - 설정 변경, 오류, 자동화 동작 등 주요 이벤트에 대해 알림 또는 안내 메시지 제공
    - UI 예시: 버튼명, 상태 메시지, 알림 예시 등 구체적으로 명시

### C. 연동 및 UX
- 외부 스크립트 실행은 사용자가 직접 하거나, 플러그인에서 명령어로 실행(옵션)
- 결과 파일이 생성/갱신되면 플러그인에서 노트로 변환
- 오류 발생 시 사용자에게 알림
- Zoom 미팅 시작/종료 시점에 맞춰 발화자 트래킹 스크립트가 자동으로 실행/종료되는 사용자 경험 제공(추가)

## 4. 예시 워크플로우
1. 사용자가 Zoom 미팅 시작 → Summar Plugin이 자동 녹음 시작 → 외부 스크립트(발화자 트래킹)도 자동 시작
2. 미팅 종료 시 녹음과 발화자 트래킹 스크립트가 함께 종료
3. 스크립트가 발화자/타임스탬프를 기록하여 `zoom_speaker_log_20250605T100000_ID123456.json` 저장
4. Obsidian Summar 플러그인에서 해당 파일을 읽어 "회의 발화자 타임라인" 노트 생성

## 5. 파일 포맷 예시 (JSON)
```json
[
  { "speaker": "홍길동", "start": "2025-06-05T10:00:00+09:00", "end": "2025-06-05T10:01:12+09:00" },
  { "speaker": "김철수", "start": "2025-06-05T10:01:12+09:00", "end": "2025-06-05T10:03:00+09:00" }
]
```

## 6. 마크다운 변환 예시
| 발화자   | 시작 시각           | 종료 시각           |
|----------|---------------------|---------------------|
| 홍길동   | 2025-06-05 10:00:00 | 2025-06-05 10:01:12 |
| 김철수   | 2025-06-05 10:01:12 | 2025-06-05 10:03:00 |

## 7. 구현 단계 요약
1. 외부 스크립트 개발: Zoom 화면 캡처(최우선 macOS 기본 도구 활용, 필요시 외부 라이브러리 보조) 및 발화자 감지, 결과 파일 저장
2. 플러그인 기능 추가: 결과 파일 경로 설정 UI, 결과 파일 읽기 및 마크다운 변환, 노트 생성/삽입 명령 추가
3. 테스트 및 UX 개선: 파일 포맷 호환성, 오류 처리, 자동화 옵션 등
4. 테스트 케이스/시나리오: Zoom 미팅 중간 종료, 참가자 이름 없음, 권한 미획득, 파일 충돌 등 다양한 예외 상황에 대한 테스트 시나리오 포함
